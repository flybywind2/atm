/**
 * Document Viewer Component
 * 
 * This component displays the final analysis results including generated documents,
 * with support for multiple document types and export functionality.
 */

class DocumentViewerComponent {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
        this.documents = {};
        this.currentDocument = null;
        this.solutionInfo = {};
        
        this.render();
        this.setupEventListeners();
    }
    
    /**
     * Render the component HTML
     */
    render() {\n        this.container.innerHTML = `\n            <div class=\"document-viewer\">\n                <div class=\"results-header\">\n                    <div class=\"completion-status\">\n                        <span class=\"status-icon\">âœ…</span>\n                        <h3>ë¶„ì„ ì™„ë£Œ!</h3>\n                        <p>ë¬¸ì œ ë¶„ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>\n                    </div>\n                    \n                    <div id=\"solution-summary\" class=\"solution-summary hidden\">\n                        <div class=\"summary-item\">\n                            <label>ì†”ë£¨ì…˜ ìœ í˜•:</label>\n                            <span id=\"solution-type\">-</span>\n                        </div>\n                        <div class=\"summary-item\">\n                            <label>ì¶”ì²œ ê¸°ìˆ  ìŠ¤íƒ:</label>\n                            <div id=\"tech-stack\" class=\"tech-stack\"></div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"document-tabs\">\n                    <button class=\"tab-button active\" data-doc=\"requirements\">\n                        ğŸ“‹ ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ\n                    </button>\n                    <button class=\"tab-button\" data-doc=\"journey\">\n                        ğŸ—ºï¸ ì‚¬ìš©ì ì—¬ì • ì§€ë„\n                    </button>\n                    <button class=\"tab-button\" data-doc=\"guide\">\n                        ğŸ“š êµ¬í˜„ ê°€ì´ë“œ\n                    </button>\n                    <button class=\"tab-button\" data-doc=\"tech\">\n                        ğŸ”§ ê¸°ìˆ  ì¶”ì²œì„œ\n                    </button>\n                </div>\n                \n                <div class=\"document-content-container\">\n                    <div id=\"document-content\" class=\"document-content\">\n                        <div class=\"loading-state\">\n                            <p>ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n                        </div>\n                    </div>\n                    \n                    <div class=\"document-actions\">\n                        <button type=\"button\" class=\"btn btn-primary\" id=\"download-btn\">\n                            ğŸ“¥ ë‹¤ìš´ë¡œë“œ\n                        </button>\n                        \n                        <button type=\"button\" class=\"btn btn-outline\" id=\"copy-btn\">\n                            ğŸ“‹ ë³µì‚¬\n                        </button>\n                        \n                        <button type=\"button\" class=\"btn btn-outline\" id=\"print-btn\">\n                            ğŸ–¨ï¸ ì¸ì‡„\n                        </button>\n                        \n                        <div class=\"action-group\">\n                            <button type=\"button\" class=\"btn btn-outline\" id=\"download-all-btn\">\n                                ğŸ“¦ ì „ì²´ ë‹¤ìš´ë¡œë“œ\n                            </button>\n                            \n                            <button type=\"button\" class=\"btn btn-outline\" id=\"new-analysis-btn\">\n                                ğŸ”„ ìƒˆ ë¶„ì„ ì‹œì‘\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                \n                <div id=\"export-options\" class=\"export-options hidden\">\n                    <h4>ë‚´ë³´ë‚´ê¸° ì˜µì…˜</h4>\n                    <div class=\"export-formats\">\n                        <button class=\"format-btn\" data-format=\"markdown\">\n                            ğŸ“ Markdown (.md)\n                        </button>\n                        <button class=\"format-btn\" data-format=\"html\">\n                            ğŸŒ HTML (.html)\n                        </button>\n                        <button class=\"format-btn\" data-format=\"pdf\">\n                            ğŸ“„ PDF (.pdf)\n                        </button>\n                        <button class=\"format-btn\" data-format=\"txt\">\n                            ğŸ“ƒ í…ìŠ¤íŠ¸ (.txt)\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    \n    /**\n     * Setup event listeners\n     */\n    setupEventListeners() {\n        const tabButtons = this.container.querySelectorAll('.tab-button');\n        const downloadBtn = this.container.querySelector('#download-btn');\n        const copyBtn = this.container.querySelector('#copy-btn');\n        const printBtn = this.container.querySelector('#print-btn');\n        const downloadAllBtn = this.container.querySelector('#download-all-btn');\n        const newAnalysisBtn = this.container.querySelector('#new-analysis-btn');\n        const formatButtons = this.container.querySelectorAll('.format-btn');\n        \n        // Tab switching\n        tabButtons.forEach(button => {\n            button.addEventListener('click', () => {\n                const docType = button.dataset.doc;\n                this.switchDocument(docType);\n                \n                // Update active tab\n                tabButtons.forEach(btn => btn.classList.remove('active'));\n                button.classList.add('active');\n            });\n        });\n        \n        // Document actions\n        downloadBtn.addEventListener('click', () => this.downloadCurrentDocument());\n        copyBtn.addEventListener('click', () => this.copyCurrentDocument());\n        printBtn.addEventListener('click', () => this.printCurrentDocument());\n        downloadAllBtn.addEventListener('click', () => this.downloadAllDocuments());\n        newAnalysisBtn.addEventListener('click', () => this.startNewAnalysis());\n        \n        // Export format selection\n        formatButtons.forEach(button => {\n            button.addEventListener('click', () => {\n                const format = button.dataset.format;\n                this.exportCurrentDocument(format);\n            });\n        });\n    }\n    \n    /**\n     * Display analysis results\n     */\n    displayResults(results) {\n        this.documents = results.documents || {};\n        this.solutionInfo = {\n            type: results.solution_type,\n            techStack: results.tech_stack || []\n        };\n        \n        // Update solution summary\n        this.updateSolutionSummary();\n        \n        // Display first document\n        this.switchDocument('requirements');\n    }\n    \n    /**\n     * Update solution summary section\n     */\n    updateSolutionSummary() {\n        const summaryElement = this.container.querySelector('#solution-summary');\n        const solutionTypeElement = this.container.querySelector('#solution-type');\n        const techStackElement = this.container.querySelector('#tech-stack');\n        \n        if (this.solutionInfo.type) {\n            solutionTypeElement.textContent = this.getSolutionTypeLabel(this.solutionInfo.type);\n            \n            if (this.solutionInfo.techStack && this.solutionInfo.techStack.length > 0) {\n                techStackElement.innerHTML = this.solutionInfo.techStack\n                    .map(tech => `<span class=\"tech-tag\">${tech}</span>`)\n                    .join('');\n            } else {\n                techStackElement.textContent = 'ì •ë³´ ì—†ìŒ';\n            }\n            \n            summaryElement.classList.remove('hidden');\n        }\n    }\n    \n    /**\n     * Get human-readable solution type label\n     */\n    getSolutionTypeLabel(type) {\n        const labels = {\n            'SIMPLE_AUTOMATION': 'ê¸°ë³¸ ìë™í™”',\n            'COMPLEX_AUTOMATION': 'ê³ ê¸‰ ìë™í™”',\n            'RAG': 'ê²€ìƒ‰ ì¦ê°• ìƒì„±',\n            'ADVANCED_RAG': 'ê³ ê¸‰ RAG',\n            'ML_CLASSIFICATION': 'ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜',\n            'DASHBOARD': 'ëŒ€ì‹œë³´ë“œ',\n            'API_INTEGRATION': 'API í†µí•©',\n            'RAG_AUTOMATION': 'RAG + ìë™í™”',\n            'AUTOMATION_DASHBOARD': 'ìë™í™” + ëŒ€ì‹œë³´ë“œ',\n            'ML_RAG': 'ë¨¸ì‹ ëŸ¬ë‹ + RAG'\n        };\n        \n        return labels[type] || type;\n    }\n    \n    /**\n     * Switch to a different document\n     */\n    switchDocument(docType) {\n        this.currentDocument = docType;\n        \n        const contentElement = this.container.querySelector('#document-content');\n        \n        const documentMap = {\n            'requirements': 'requirements_document',\n            'journey': 'user_journey_map', \n            'guide': 'implementation_guide',\n            'tech': 'tech_recommendations'\n        };\n        \n        const documentKey = documentMap[docType];\n        const documentContent = this.documents[documentKey];\n        \n        if (documentContent) {\n            // Render markdown content\n            const htmlContent = window.MarkdownRenderer.renderWithContainer(\n                documentContent, \n                'markdown-content'\n            );\n            contentElement.innerHTML = htmlContent;\n            \n            // Initialize syntax highlighting if available\n            if (window.hljs) {\n                contentElement.querySelectorAll('pre code').forEach(block => {\n                    window.hljs.highlightElement(block);\n                });\n            }\n        } else {\n            contentElement.innerHTML = `\n                <div class=\"no-content\">\n                    <p>âš ï¸ ì´ ë¬¸ì„œëŠ” ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>\n                    <p>ë¶„ì„ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n                </div>\n            `;\n        }\n        \n        // Scroll to top\n        contentElement.scrollTop = 0;\n    }\n    \n    /**\n     * Download current document\n     */\n    downloadCurrentDocument() {\n        if (!this.currentDocument) return;\n        \n        const documentMap = {\n            'requirements': { key: 'requirements_document', filename: 'ìš”êµ¬ì‚¬í•­_ëª…ì„¸ì„œ.md' },\n            'journey': { key: 'user_journey_map', filename: 'ì‚¬ìš©ì_ì—¬ì •_ì§€ë„.md' },\n            'guide': { key: 'implementation_guide', filename: 'êµ¬í˜„_ê°€ì´ë“œ.md' },\n            'tech': { key: 'tech_recommendations', filename: 'ê¸°ìˆ _ì¶”ì²œì„œ.md' }\n        };\n        \n        const docInfo = documentMap[this.currentDocument];\n        const content = this.documents[docInfo.key];\n        \n        if (content) {\n            window.MarkdownRenderer.createDownloadableContent(content, docInfo.filename);\n        }\n    }\n    \n    /**\n     * Copy current document to clipboard\n     */\n    async copyCurrentDocument() {\n        if (!this.currentDocument) return;\n        \n        const documentMap = {\n            'requirements': 'requirements_document',\n            'journey': 'user_journey_map',\n            'guide': 'implementation_guide', \n            'tech': 'tech_recommendations'\n        };\n        \n        const documentKey = documentMap[this.currentDocument];\n        const content = this.documents[documentKey];\n        \n        if (content) {\n            const success = await window.MarkdownRenderer.copyToClipboard(content);\n            \n            if (success) {\n                this.showToast('ë¬¸ì„œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');\n            } else {\n                this.showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error');\n            }\n        }\n    }\n    \n    /**\n     * Print current document\n     */\n    printCurrentDocument() {\n        const contentElement = this.container.querySelector('#document-content');\n        const content = contentElement.innerHTML;\n        \n        const printWindow = window.open('', '_blank');\n        printWindow.document.write(`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>ë¶„ì„ ê²°ê³¼ - ${this.getDocumentTitle()}</title>\n                <style>\n                    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }\n                    .markdown-content { max-width: none; }\n                    pre { background: #f5f5f5; padding: 1rem; border-radius: 4px; }\n                    code { background: #f0f0f0; padding: 0.2rem 0.4rem; border-radius: 2px; }\n                    table { border-collapse: collapse; width: 100%; }\n                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n                    th { background-color: #f2f2f2; }\n                </style>\n            </head>\n            <body>\n                ${content}\n            </body>\n            </html>\n        `);\n        printWindow.document.close();\n        printWindow.print();\n    }\n    \n    /**\n     * Download all documents as a ZIP file\n     */\n    downloadAllDocuments() {\n        // This would require a ZIP library or server-side support\n        // For now, download documents individually\n        Object.keys(this.documents).forEach((key, index) => {\n            setTimeout(() => {\n                const docType = this.getDocTypeFromKey(key);\n                if (docType) {\n                    this.currentDocument = docType;\n                    this.downloadCurrentDocument();\n                }\n            }, index * 500); // Stagger downloads\n        });\n        \n        this.showToast('ëª¨ë“  ë¬¸ì„œ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.', 'info');\n    }\n    \n    /**\n     * Get document type from key\n     */\n    getDocTypeFromKey(key) {\n        const mapping = {\n            'requirements_document': 'requirements',\n            'user_journey_map': 'journey',\n            'implementation_guide': 'guide',\n            'tech_recommendations': 'tech'\n        };\n        return mapping[key];\n    }\n    \n    /**\n     * Export current document in specified format\n     */\n    exportCurrentDocument(format) {\n        if (!this.currentDocument) return;\n        \n        const documentMap = {\n            'requirements': 'requirements_document',\n            'journey': 'user_journey_map',\n            'guide': 'implementation_guide',\n            'tech': 'tech_recommendations'\n        };\n        \n        const documentKey = documentMap[this.currentDocument];\n        const content = this.documents[documentKey];\n        \n        if (!content) return;\n        \n        const filename = this.getDocumentTitle();\n        \n        switch (format) {\n            case 'markdown':\n                window.MarkdownRenderer.createDownloadableContent(content, `${filename}.md`);\n                break;\n            case 'html':\n                const htmlContent = window.MarkdownRenderer.render(content);\n                const blob = new Blob([`<!DOCTYPE html><html><head><meta charset=\"UTF-8\"><title>${filename}</title></head><body>${htmlContent}</body></html>`], { type: 'text/html' });\n                this.downloadBlob(blob, `${filename}.html`);\n                break;\n            case 'txt':\n                const textContent = window.MarkdownRenderer.extractText(content);\n                const textBlob = new Blob([textContent], { type: 'text/plain' });\n                this.downloadBlob(textBlob, `${filename}.txt`);\n                break;\n            case 'pdf':\n                this.showToast('PDF ë‚´ë³´ë‚´ê¸°ëŠ” ì•„ì§ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'warning');\n                break;\n        }\n    }\n    \n    /**\n     * Download blob as file\n     */\n    downloadBlob(blob, filename) {\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = filename;\n        link.style.display = 'none';\n        \n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        \n        URL.revokeObjectURL(url);\n    }\n    \n    /**\n     * Get current document title\n     */\n    getDocumentTitle() {\n        const titles = {\n            'requirements': 'ìš”êµ¬ì‚¬í•­_ëª…ì„¸ì„œ',\n            'journey': 'ì‚¬ìš©ì_ì—¬ì •_ì§€ë„',\n            'guide': 'êµ¬í˜„_ê°€ì´ë“œ',\n            'tech': 'ê¸°ìˆ _ì¶”ì²œì„œ'\n        };\n        \n        return titles[this.currentDocument] || 'ë¬¸ì„œ';\n    }\n    \n    /**\n     * Start new analysis\n     */\n    startNewAnalysis() {\n        if (confirm('ìƒˆë¡œìš´ ë¶„ì„ì„ ì‹œì‘í•˜ë©´ í˜„ì¬ ê²°ê³¼ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n            // Reset application state\n            if (window.ProblemSolvingApp) {\n                window.ProblemSolvingApp.reset();\n            }\n        }\n    }\n    \n    /**\n     * Show toast notification\n     */\n    showToast(message, type = 'info') {\n        // Create toast element\n        const toast = document.createElement('div');\n        toast.className = `toast toast-${type}`;\n        toast.textContent = message;\n        \n        // Style the toast\n        toast.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};\n            color: white;\n            padding: 12px 16px;\n            border-radius: 8px;\n            z-index: 1000;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        `;\n        \n        document.body.appendChild(toast);\n        \n        // Show toast\n        setTimeout(() => {\n            toast.style.opacity = '1';\n        }, 100);\n        \n        // Hide toast\n        setTimeout(() => {\n            toast.style.opacity = '0';\n            setTimeout(() => {\n                if (document.body.contains(toast)) {\n                    document.body.removeChild(toast);\n                }\n            }, 300);\n        }, 3000);\n    }\n    \n    /**\n     * Reset component\n     */\n    reset() {\n        this.documents = {};\n        this.currentDocument = null;\n        this.solutionInfo = {};\n        \n        // Reset to initial state\n        this.render();\n        this.setupEventListeners();\n    }\n}\n\n// Export for global use\nwindow.DocumentViewerComponent = DocumentViewerComponent;\n\n// Export for Node.js if needed\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = DocumentViewerComponent;\n}